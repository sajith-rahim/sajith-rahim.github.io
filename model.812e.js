const CANVAS_SIZE=280,CANVAS_SCALE=.5,canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),clearButton=document.getElementById("clear-button");let isMouseDown=!1,hasIntroText=!0,lastX=0,lastY=0;const sess=new onnx.InferenceSession,loadingModelPromise=sess.loadModel("./onnx_model.onnx");function clearCanvas(){ctx.clearRect(0,0,CANVAS_SIZE,CANVAS_SIZE);for(let e=0;e<10;e++){const t=document.getElementById(`prediction-${e}`);t.className="prediction-col",t.children[0].children[0].style.height="0"}}function drawLine(e,t,n,o){ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(n,o),ctx.closePath(),ctx.stroke(),updatePredictions()}async function updatePredictions(){const e=ctx.getImageData(0,0,CANVAS_SIZE,CANVAS_SIZE),t=new onnx.Tensor(new Float32Array(e.data),"float32"),n=(await sess.run([t])).values().next().value.data,o=Math.max(...n);for(let e=0;e<n.length;e++){const t=document.getElementById(`prediction-${e}`);t.children[0].children[0].style.height=`${100*n[e]}%`,t.className=n[e]===o?"prediction-col top-prediction":"prediction-col"}}function canvasMouseDown(e){isMouseDown=!0,hasIntroText&&(clearCanvas(),hasIntroText=!1);const t=e.offsetX/CANVAS_SCALE,n=e.offsetY/CANVAS_SCALE;lastX=t+.001,lastY=n+.001,canvasMouseMove(e)}function canvasMouseMove(e){const t=e.offsetX/CANVAS_SCALE,n=e.offsetY/CANVAS_SCALE;isMouseDown&&drawLine(lastX,lastY,t,n),lastX=t,lastY=n}function bodyMouseUp(){isMouseDown=!1}function bodyMouseOut(e){e.relatedTarget&&"HTML"!==e.relatedTarget.nodeName||(isMouseDown=!1)}ctx.lineWidth=28,ctx.lineJoin="round",ctx.font="28px sans-serif",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="#fff",ctx.fillText("Loading...",CANVAS_SIZE/2,CANVAS_SIZE/2),ctx.strokeStyle="#fff",loadingModelPromise.then(()=>{canvas.addEventListener("mousedown",canvasMouseDown),canvas.addEventListener("mousemove",canvasMouseMove),document.body.addEventListener("mouseup",bodyMouseUp),document.body.addEventListener("mouseout",bodyMouseOut),clearButton.addEventListener("mousedown",clearCanvas),ctx.clearRect(0,0,CANVAS_SIZE,CANVAS_SIZE),ctx.fillText("Draw a number",CANVAS_SIZE/2,CANVAS_SIZE/2),setTimeout(document.getElementById("loader").style.display="none",9e3)});